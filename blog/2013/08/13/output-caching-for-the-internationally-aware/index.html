
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Output Caching for the Internationally Aware - Development - Just the Good Bits</title>
  <meta name="author" content="David Sulpy">

  
  <meta name="description" content="Output caching is highly recommended for high traffic sites. Microsoft offers output caching out of the box for MVC applications through the System. &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://davidsulpy.github.io/blog/2013/08/13/output-caching-for-the-internationally-aware">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="Development - Just the Good Bits" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="./javascripts/lib/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-42577443-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">Development - Just the Good Bits</a></h1>
  
    <h2>developing, automating, hacking, and securing</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:davidsulpy.github.io" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div>
<article class="hentry" role="article">
  
  <header>
    
      <h1 class="entry-title">Output Caching for the Internationally Aware</h1>
    
    
      <p class="meta">
        








  


<time datetime="2013-08-13T10:27:00-05:00" pubdate data-updated="true">Aug 13<span>th</span>, 2013</time>
        
      </p>
    
  </header>


<div class="entry-content"><p>Output caching is highly recommended for high traffic sites. Microsoft offers output caching out of the box for MVC applications through the <code>System.Web.Mvc</code> namespace. With the <code>OutputCache</code> attribute class you can specify certain MVC actions on a controller to return cached outputs. This will greatly reduce server load and improve responstime for large scale applications.</p>

<p>However, whole-section or whole-page output caching for a server-side dynamic site doesn&rsquo;t meet everyone&rsquo;s needs out of the box. What if you have certain areas of your site that are user-specific dynamic and, more importantly, have pii that should at least be prevented by accidental access from another user? Enter, donut hole caching, or donut caching. This allows the caching of just specific areas of a site (donut hole caching) or excluding specific areas from cache (donut caching) so you don&rsquo;t cache areas such as the login information in the top right corner of a page to be viewed by anyone.</p>

<p>DevTrends created a great library for donut caching on MVC. You can access it in NuGet <code>Install-Package MvcDonutCaching</code>. DevTrends also has a much more indepth article on the matter <a href="http://www.devtrends.co.uk/blog/donut-output-caching-in-asp.net-mvc-3">here</a>.</p>

<p>Because there&rsquo;s already a great article on output caching in MVC already. I&rsquo;ll focus on internationalization.</p>

<p>There are a couple unfortunate things about DevTrends MvcDonutCaching library 1) It is currently up for adoption and 2) It doesn&rsquo;t seem to currently have support for the VaryByHeader functionality in Microsoft&rsquo;s MVC OutputCaching.</p>

<h3>OutputCaching: Utilizing VaryByHeader</h3>

<p>The OutputCache class has a <code>VaryByHeader</code> property that you can set to allow output cache keys to vary by headers passed from a browser. This is especially useful when your site is translated based on browser culture. The standard browser will send culture information up on a request in the <code>Accept-Language</code> header key. This header&rsquo;s value is a prioritized list of culture strings. For instance, if my main language is French, but I also understand English, my header might look like this from Firefox:</p>

<p><img src="http://davidsulpy.github.io/images/IRb2U83DK2m73PsgPRx-YuU2rlP2fb2RZokh8LfZ4NY.png" alt="firefox request headers" /></p>

<p>You can specify that cache keys take this into consideration and append the header values to the keys so that visits in China don&rsquo;t influence the output of visitors in France. Below is an example of doing this in the attribute:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='csharp'><span class='line'><span class="na">[OutputCache(CacheProfile = &quot;Cache1HourInternational&quot;, VaryByHeader = &quot;Accept-Language&quot;)]</span>
</span><span class='line'><span class="k">public</span> <span class="n">ActionResult</span> <span class="nf">Index</span><span class="p">()</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>  <span class="k">return</span> <span class="nf">View</span><span class="p">();</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>By naming the CacheProfile, you also have the benefit of specifying in the config like so:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class='xml'><span class='line'><span class="nt">&lt;caching&gt;</span>
</span><span class='line'>      <span class="nt">&lt;outputCache</span> <span class="na">defaultProvider=</span><span class="s">&quot;Memcached&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>        <span class="nt">&lt;providers&gt;</span>
</span><span class='line'>          <span class="nt">&lt;add</span> <span class="na">name=</span><span class="s">&quot;Memcached&quot;</span> <span class="na">type=</span><span class="s">&quot;MemcachedOutputCacheProviderNamespace&quot;</span> <span class="nt">/&gt;</span>
</span><span class='line'>        <span class="nt">&lt;/providers&gt;</span>
</span><span class='line'>      <span class="nt">&lt;/outputCache&gt;</span>
</span><span class='line'>      <span class="nt">&lt;outputCacheSettings&gt;</span>
</span><span class='line'>        <span class="nt">&lt;outputCacheProfiles&gt;</span>
</span><span class='line'>          <span class="nt">&lt;add</span> <span class="na">name=</span><span class="s">&quot;Cache1HourInternational&quot;</span> <span class="na">duration=</span><span class="s">&quot;3600&quot;</span> <span class="na">varyByParam=</span><span class="s">&quot;none&quot;</span> <span class="na">varyByHeader=</span><span class="s">&quot;Accept-Language&quot;</span><span class="nt">/&gt;</span>
</span><span class='line'>        <span class="nt">&lt;/outputCacheProfiles&gt;</span>
</span><span class='line'>      <span class="nt">&lt;/outputCacheSettings&gt;</span>
</span><span class='line'>    <span class="nt">&lt;/caching&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>With this, we can reliably output cache all pages from ActionResults that have the <code>OutputCache</code> attribute and the CacheProfile <code>Cache1HourInternational</code>.</p>
</div>


  <footer>
    <p class="meta">
      
  

<span class="byline author vcard">Posted by <span class="fn">David Sulpy</span></span>

      








  


<time datetime="2013-08-13T10:27:00-05:00" pubdate data-updated="true">Aug 13<span>th</span>, 2013</time>
      

<span class="categories">
  
    <a class='category' href='/blog/categories/asp-dot-net/'>asp.net</a>, <a class='category' href='/blog/categories/caching/'>caching</a>, <a class='category' href='/blog/categories/outputcaching/'>outputcaching</a>
  
</span>


    </p>
    
      <div class="sharing">
  
  <a href="//twitter.com/share" class="twitter-share-button" data-url="http://davidsulpy.github.io/blog/2013/08/13/output-caching-for-the-internationally-aware/" data-via="davidsulpy" data-counturl="http://davidsulpy.github.io/blog/2013/08/13/output-caching-for-the-internationally-aware/" >Tweet</a>
  
  
  
</div>

    
    <p class="meta">
      
        <a class="basic-alignment left" href="/blog/2013/07/19/how-to-build-a-resilient-aws-ec2-linux-instance-utilizing-nginx-and-node-dot-js-part-2/" title="Previous Post: How to Build a Resilient AWS EC2 Linux Instance Utilizing Nginx and Node.js (Part 2)">&laquo; How to Build a Resilient AWS EC2 Linux Instance Utilizing Nginx and Node.js (Part 2)</a>
      
      
    </p>
  </footer>
</article>

</div>

<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2013/08/13/output-caching-for-the-internationally-aware/">Output Caching for the Internationally Aware</a>
      </li>
    
      <li class="post">
        <a href="/blog/2013/07/19/how-to-build-a-resilient-aws-ec2-linux-instance-utilizing-nginx-and-node-dot-js-part-2/">How to Build a Resilient AWS EC2 Linux Instance Utilizing Nginx and Node.js (Part 2)</a>
      </li>
    
      <li class="post">
        <a href="/blog/2013/07/13/how-to-build-a-resilient-aws-ec2-linux-instance-utilizing-nginx-and-node-dot-js/">How to Build a Resilient AWS EC2 Linux Instance Utilizing Nginx and node.js</a>
      </li>
    
  </ul>
</section>
<section>
<div style="margin-left: -20px;">
<script type="text/javascript"><!--
google_ad_client = "ca-pub-4394360562836528";
/* sidebar */
google_ad_slot = "4152463098";
google_ad_width = 300;
google_ad_height = 250;
//-->
</script>
<script type="text/javascript"
src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
</script>
</div>
</section>
<section>
  <h1>GitHub Repos</h1>
  <ul id="gh_repos">
    <li class="loading">Status updating...</li>
  </ul>
  
  <a href="https://github.com/davidsulpy">@davidsulpy</a> on GitHub
  
  <script type="text/javascript">
    $(document).ready(function(){
        if (!window.jXHR){
            var jxhr = document.createElement('script');
            jxhr.type = 'text/javascript';
            jxhr.src = '/javascripts/libs/jXHR.js';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(jxhr, s);
        }

        github.showRepos({
            user: 'davidsulpy',
            count: 0,
            skip_forks: true,
            target: '#gh_repos'
        });
    });
  </script>
  <script src="/javascripts/github.js" type="text/javascript"> </script>
</section>



<section class="googleplus">
  <h1>
    <a href="https://plus.google.com/113065410361553246509?rel=author">
      <img src="http://www.google.com/images/icons/ui/gprofile_button-32.png" width="32" height="32">
      Google+
    </a>
  </h1>
</section>



  
</aside>


    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2013 - David Sulpy -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  







  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = '//platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
